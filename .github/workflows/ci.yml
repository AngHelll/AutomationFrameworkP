# âš¡ CI/CD Workflow - Direct Python Approach (RECOMMENDED)
# 
# ğŸ¯ What this does:
#    - Installs Python directly on GitHub's runner
#    - Runs tests without Docker (faster!)
#    - Perfect for daily development
#
# â±ï¸  Execution time: ~1 minute (with cache)
# ğŸ’° Cost: LOW (less compute time)
# ğŸ“ Recommended for: Regular CI/CD, fast feedback
#
# ğŸ“Š When it runs:
#    - Every push to main branch
#    - Every pull request to main branch

name: CI - Run Automation Tests

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    # ğŸ–¥ï¸  Run on Ubuntu (free GitHub runner)
    runs-on: ubuntu-latest

    steps:
      # ğŸ“¥ STEP 1: Get the code
      # Downloads your repository code to the runner
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4  # âœ… Latest version
        # This action downloads your entire repo to the runner
        # so tests can access all your framework files

      # ğŸ STEP 2: Setup Python
      # Installs Python on the GitHub runner
      - name: ğŸ Set up Python 3.11
        uses: actions/setup-python@v4  # âœ… Latest version
        with:
          python-version: "3.11"
        # Why Python 3.11?
        # - Modern features
        # - Fast performance
        # - Matches local development

      # ğŸ“¦ STEP 3: Install Dependencies
      # Installs all packages from requirements.txt
      - name: ğŸ“¦ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
        # What's happening:
        # 1. Upgrade pip to latest version (security + features)
        # 2. Install all packages: pytest, selenium, behave, etc.
        # ğŸ’¡ TIP: GitHub caches these! 2nd run is much faster

      # ğŸ§ª STEP 4: Run Tests
      # Execute all Pytest tests with parallel execution
      - name: ğŸ§ª Run Tests with Parallel Execution
        run: pytest -n auto --html=reports/test_report.html --self-contained-html
        # Command breakdown:
        # - pytest          â†’ Run test framework
        # - -n auto         â†’ Parallel execution (use all CPU cores)
        # - --html=...      â†’ Generate HTML report
        # - --self-contained-html â†’ Embed everything in one file
        # 
        # âš¡ Parallel execution means:
        #    1 core  = 30 seconds
        #    4 cores = 10 seconds (much faster!)

      # ğŸ“Š STEP 5: Save Test Reports
      # Upload reports so you can download them later
      - name: ğŸ“Š Upload Test Reports as Artifacts
        uses: actions/upload-artifact@v4  # âœ… Latest version
        with:
          name: test-reports
          path: reports/test_report.html
          retention-days: 7
        # What this does:
        # - Saves test report as downloadable artifact
        # - Available in GitHub Actions UI
        # - Keeps for 7 days (adjust if needed)
        # - Can download even if tests fail
        # 
        # ğŸ“¥ To download:
        #    Actions â†’ Click workflow run â†’ Scroll to Artifacts

# ğŸ¯ WORKFLOW SUMMARY:
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# 1. Checkout     â†’  5 seconds   ğŸ“¥ Get code
# 2. Setup Python â†’ 10 seconds   ğŸ Install Python
# 3. Install Deps â†’ 20 seconds   ğŸ“¦ pip install (cached!)
# 4. Run Tests    â†’ 30 seconds   ğŸ§ª Execute tests
# 5. Upload       â†’  5 seconds   ğŸ“Š Save reports
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# TOTAL:          ~70 seconds    âš¡ Fast feedback!
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ’¡ TIPS:
# - First run takes longer (no cache)
# - Subsequent runs are much faster
# - Use this for daily development
# - Perfect for pull request checks
#
# ğŸ› DEBUGGING:
# - Check each step's logs in GitHub Actions
# - Download artifacts to see test reports
# - Tests run in headless mode (no browser visible)
#
# âœ… SUCCESS CRITERIA:
# - All steps complete with green checkmarks
# - pytest exit code 0 (all tests pass)
# - HTML report generated and uploaded
